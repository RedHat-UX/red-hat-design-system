---
layout: layout-tokens.njk
templateEngineOverride: njk
title: Search Results
---

<section class="results-section">
  <div id="results" hidden></div>
  <ol id="results-list" hidden></ol>
</section>

{% include 'token-collections.njk' %}

<script type="module">
  import { html, render } from 'lit';
  import { fuse } from '/assets/search-tokens.js';

  const params = new URLSearchParams(location.search);
  const searchTerm = params.get('s');
  const searchResults = fuse.search(searchTerm)?.map(x => x.item);
  const results = document.getElementById('results');
  const resultsList = document.getElementById('results-list');

  // Results response
  if (searchResults.length > 0 && searchTerm) {

    const resultsHTML = (numResults, term) =>
      html`
        <p>Showing ${numResults} results for "${term}"</p>
      `;

    render(searchResults?.map(({ label, value }) => html`
      <li><a href="${value}">${label}</a></li>
    `), resultsList);

    render(resultsHTML(searchResults.length, searchTerm), results);


    results.hidden = false;
    resultsList.hidden = false;
  }

  // No results response
  if (searchResults.length === 0 && searchTerm) {

    const noResultsHTML = term =>
      html`
        <p>No search results for "${term}"</p>
      `;

    render(noResultsHTML(searchTerm), results);
    results.hidden = false;
    resultsList.hidden = true;
  }

  // category bricks
  for (const brick of document.querySelectorAll('.token-category')) {
    // mark category cards which contain tokens in the search results
    const categoryTokens = searchResults?.filter(({ label }) =>
      label.includes(brick.dataset.category))??[];
    const ol = brick.querySelector('ol');

    brick.classList.toggle('found', !!categoryTokens.length);
  }
</script>
