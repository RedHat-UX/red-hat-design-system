---
layout: layout-tokens.njk
templateEngineOverride: njk
title: Search Results
---

<!-- <ol id="results" hidden></ol> -->
<div id="results" hidden>
  <ol id="results-list" hidden></ol>
</div>

{% include 'token-collections.njk' %}

<script type="module">
  import { html, render } from 'lit';
  import { fuse } from '/assets/search-tokens.js';

  const params = new URLSearchParams(location.search);
  const searchTerm = params.get('s');
  const searchResults = fuse.search(searchTerm)?.map(x => x.item);


  const results = document.getElementById('results');
  const resultsList = document.getElementById('results-list');

  render(searchResults?.map(({ label, value }) => html`
    <li><a href="${value}">${label}</a></li>
  `), resultsList);

  // category cards
  for (const card of document.querySelectorAll('.token-category')) {
    // mark category cards which contain tokens in the search results
    const categoryTokens = searchResults?.filter(({ label }) =>
      label.includes(card.dataset.category))??[];
    const ol = card.querySelector('ol');

    // render(categoryTokens.map(({ label, value }) => html`
    //   <li><a href="${value}">${label}</a></li>
    // `), ol);

    card.classList.toggle('found', !!categoryTokens.length);

    // if (!!categoryTokens.length) {
    //   ol.hidden = false;
    // } else {
    //   card.hidden = true;
    // }
  }

  results.hidden = false;
  resultsList.hidden = false;

  // No results response
  if (searchResults.length === 0 && searchTerm) {

    const noResultsHTML = term =>
      html`
        <p>No search results for "${term}"</p>
      `;

    // render(noResultsHTML(searchTerm), noResults);
    // noResults.hidden = false;
    render(noResultsHTML(searchTerm), results);
    results.hidden = false;
    resultsList.hidden = true;
  }
</script>
