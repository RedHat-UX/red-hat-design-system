<div id="rh-icon-demo-output"></div>

<script type="module">
/**
  * Modified: Adam Argyle's Gui Challenges Toast
  * https://github.com/argyleink/gui-challenges/blob/main/toast/toast.js
  * Apache License https://github.com/argyleink/gui-challenges/blob/main/LICENSE
  */

  const init = () => {
    const node = document.createElement('section')
    node.classList.add('gui-toast-group')
    const output = document.getElementById('rh-icon-demo-output')
    output.insertAdjacentElement("beforeend",node);
    return node
  }

  const createToast = text => {
    const node = document.createElement('output')
    const toast = document.querySelector('#toast').content.cloneNode(true);
    toast.querySelector('p.text').innerText = text;
    node.appendChild(toast);
    node.classList.add('gui-toast')
    node.setAttribute('role', 'status')
    node.setAttribute('aria-live', 'polite')

    return node
  }

  const addToast = toast => {
    const { matches:motionOK } = window.matchMedia(
      '(prefers-reduced-motion: no-preference)'
    )

    Toaster.children.length && motionOK
      ? flipToast(toast)
      : Toaster.appendChild(toast)
  }

const Toast = text => {
  let toast = createToast(text);
  addToast(toast);

  const animationPromises = toast.getAnimations().map(animation => animation.finished);

  return Promise.all(animationPromises).then(() => {
    Toaster.removeChild(toast);
  });
};

  // https://aerotwist.com/blog/flip-your-animations/
  const flipToast = toast => {
    // FIRST
    const first = Toaster.offsetHeight

    // add new child to change container size
    Toaster.appendChild(toast)

    // LAST
    const last = Toaster.offsetHeight

    // INVERT
    const invert = last - first

    // PLAY
    const animation = Toaster.animate([
      { transform: `translateY(${invert}px)` },
      { transform: 'translateY(0)' }
    ], {
      duration: 150,
      easing: 'ease-out',
    })

    animation.startTime = document.timeline.currentTime
  }

  const Toaster = init()
  export default Toast

  import "@rhds/elements/rh-icon/rh-icon.js";
  import { RhButton } from "@rhds/elements/rh-button/rh-button.js";
  import "@rhds/elements/rh-tooltip/rh-tooltip.js";
  import "@rhds/elements/rh-alert/rh-alert.js";

  import { ui, standard, social, microns } from "@rhds/icons/icons.js";

  import { render, html } from 'lit';
  import { repeat } from 'lit/directives/repeat.js';

  document.addEventListener('click', async function() {
    if (event.target instanceof RhButton) {
      const { html, icon } = event.target.dataset;
      await navigator.clipboard.writeText(html)
      await Toast(`Copied ${icon}`);
    }
  });

  async function renderIcons(sets) {
    render(repeat(sets, (set) => {
      const [setName, icons] = set;
      return html`
        <h2 id="${setName}">${setName}</h2>
        <section aria-labelledby="${setName}">
        ${repeat(icons, (icon) => {
          const [iconName, ] = icon;
          return html`
           <figure>
            <rh-icon slot="header" set="${setName}" icon="${iconName}" load="lazy"></rh-icon>
            <figcaption>
              <span>${iconName}</span>
              <rh-tooltip>
                <rh-button name="toast" variant="link" data-html='<rh-icon set="${setName}" icon="${iconName}"></rh-icon>' data-icon="${iconName}">
                  <rh-icon set="ui" icon="copy"></rh-icon> Copy
                </rh-button>
                <pre slot="content"><code>&lt;rh-icon set="${setName}" icon="${iconName}"&gt;&lt;/rh-icon&gt;</code></pre>
              </rh-tooltip>
            </figcaption>
           </figure>
          `
        })}
        </section>
      `
    }), document.getElementById('rh-icon-demo-output'));
  }

  const sets = new Map();
  sets.set('ui', ui.entries());
  sets.set('standard', standard.entries());
  sets.set('social', social.entries());
  sets.set('microns', microns.entries());

  await renderIcons(sets);

</script>

<template id="toast">
  <rh-alert state="success">
    <h3 slot="header">Success</h3>
    <p class="text"></p>
  </rh-alert>
</template>


<style>
  #rh-icon-demo-output {
    overflow: hidden;
  }

  section {
    --rh-tooltip-max-width: 50em;
    --rh-tooltip-content-padding-block-start: 0;
    --rh-tooltip-content-padding-block-end: 0;
    display: flex;
    flex-wrap: wrap;
    gap: var(--rh-space-lg, 16px);
    margin-block-end: var(--rh-space-2xl, 32px);
  }


  figure rh-button::part(button) {
    display: flex;
    align-items: center;
    gap: var(--rh-space-xs, 4px);
  }

  figure {
    display: flex;
    flex-direction: column;
    place-items: center;
    justify-content: space-between;
    width: 12rem;
    margin: 0;
    padding: var(--rh-space-lg, 16px);
    border: var(--rh-border-width-sm, 1px) solid var(--rh-color-border-subtle-on-light, #c7c7c7);
    border-radius: var(--rh-border-radius-default, 3px);
    text-align: center;
  }

  figcaption {
    display: flex;
    flex-direction: column;
    gap: var(--rh-space-lg, 16px);
    margin-block-start: var(--rh-space-lg, 16px);
  }

  figcaption span {
    font-size: var(--rh-font-size-body-text-lg, 1.125rem);
  }

  .gui-toast-group {
    position: fixed;
    z-index: 1;
    inset-block-start: var(--rh-space-lg, 16px);
    inset-inline-end: var(--rh-space-lg, 16px);;
    padding-block-end: var(--rh-space-4xl, 64px);

    display: grid;
    justify-items: center;
    justify-content: center;
    gap: var(--rh-space-lg, 16px);

    /* optimizations */
    pointer-events: none;
  }

  .gui-toast {
    --_duration: 3s;
    --_travel-distance: 0;

    pointer-events: all;
    will-change: transform;
    animation:
      fade-in .3s ease,
      slide-in .3s ease,
      fade-out .3s ease var(--_duration);

    @media (--motionOK) {
      --_travel-distance: var(--rh-space-4xl, 64px);
    }
  }

  @keyframes fade-in {
    from { opacity: 0 }
  }

  @keyframes fade-out {
    to { opacity: 0 }
  }

  @keyframes slide-in {
    from { transform: translateY(var(--_travel-distance, var(--rh-space-lg, 16px))) }
  }
</style>
