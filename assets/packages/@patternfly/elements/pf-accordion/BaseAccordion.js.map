{"version":3,"file":"BaseAccordion.js","sourceRoot":"","sources":["BaseAccordion.ts"],"names":[],"mappings":"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","sourcesContent":["import type { TemplateResult } from 'lit';\n\nimport { LitElement, html } from 'lit';\nimport { property } from 'lit/decorators/property.js';\n\nimport { NumberListConverter, ComposedEvent } from '@patternfly/pfe-core';\nimport { Logger } from '@patternfly/pfe-core/controllers/logger.js';\n\nimport { AccordionHeaderChangeEvent, BaseAccordionHeader } from './BaseAccordionHeader.js';\nimport { BaseAccordionPanel } from './BaseAccordionPanel.js';\n\nimport { RovingTabindexController } from '@patternfly/pfe-core/controllers/roving-tabindex-controller.js';\n\nexport class AccordionExpandEvent extends ComposedEvent {\n  constructor(\n    public toggle: BaseAccordionHeader,\n    public panel: BaseAccordionPanel,\n  ) {\n    super('expand');\n  }\n}\n\nexport class AccordionCollapseEvent extends ComposedEvent {\n  constructor(\n    public toggle: BaseAccordionHeader,\n    public panel: BaseAccordionPanel,\n  ) {\n    super('collapse');\n  }\n}\n\nexport abstract class BaseAccordion extends LitElement {\n  static isAccordion(target: EventTarget | null): target is BaseAccordion {\n    return target instanceof BaseAccordion;\n  }\n\n  static isHeader(target: EventTarget | null): target is BaseAccordionHeader {\n    return target instanceof BaseAccordionHeader;\n  }\n\n  static isPanel(target: EventTarget | null): target is BaseAccordionPanel {\n    return target instanceof BaseAccordionPanel;\n  }\n\n  static #isAccordionChangeEvent(event: Event): event is AccordionHeaderChangeEvent {\n    return event instanceof AccordionHeaderChangeEvent;\n  }\n\n  #headerIndex = new RovingTabindexController<BaseAccordionHeader>(this, {\n    getItems: () => this.headers,\n  });\n\n  #expandedIndex: number[] = [];\n\n  /**\n   * Sets and reflects the currently expanded accordion 0-based indexes.\n   * Use commas to separate multiple indexes.\n   * ```html\n   * <pf-accordion expanded-index=\"1,2\">\n   *   ...\n   * </pf-accordion>\n   * ```\n   */\n  @property({\n    attribute: 'expanded-index',\n    converter: NumberListConverter\n  })\n  get expandedIndex() {\n    return this.#expandedIndex;\n  }\n\n  set expandedIndex(value) {\n    const old = this.#expandedIndex;\n    this.#expandedIndex = value;\n    if (JSON.stringify(old) !== JSON.stringify(value)) {\n      this.requestUpdate('expandedIndex', old);\n      this.collapseAll().then(async () => {\n        for (const i of this.expandedIndex) {\n          await this.expand(i, this);\n        }\n      });\n    }\n  }\n\n  get headers() {\n    return this.#allHeaders();\n  }\n\n  get panels() {\n    return this.#allPanels();\n  }\n\n  get #activeHeader() {\n    const { headers } = this;\n    const index = headers.findIndex(header => header.matches(':focus,:focus-within'));\n    return index > -1 ? headers.at(index) : undefined;\n  }\n\n  protected expandedSets = new Set<number>();\n\n  #logger = new Logger(this);\n\n  // actually is read in #init, by the `||=` operator\n  #initialized = false;\n\n  protected override async getUpdateComplete(): Promise<boolean> {\n    const c = await super.getUpdateComplete();\n    const results = await Promise.all([\n      ...this.#allHeaders().map(x => x.updateComplete),\n      ...this.#allPanels().map(x => x.updateComplete),\n    ]);\n    return c && results.every(Boolean);\n  }\n\n  #mo = new MutationObserver(() => this.#init());\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener('change', this.#onChange as EventListener);\n    this.#mo.observe(this, { childList: true });\n    this.#init();\n  }\n\n  render(): TemplateResult {\n    return html`\n      <slot></slot>\n    `;\n  }\n\n  async firstUpdated() {\n    const { headers } = this;\n    headers.forEach((header, index) => {\n      if (header.expanded) {\n        this.#expandHeader(header, index);\n        const panel = this.#panelForHeader(header);\n        if (panel) {\n          this.#expandPanel(panel);\n        }\n      }\n    });\n  }\n\n  /**\n   * Initialize the accordion by connecting headers and panels\n   * with aria controls and labels; set up the default disclosure\n   * state if not set by the author; and check the URL for default\n   * open\n   */\n  async #init() {\n    this.#initialized ||= !!await this.updateComplete;\n    // Event listener to the accordion header after the accordion has been initialized to add the roving tabindex\n    this.addEventListener('focusin', this.#updateActiveHeader);\n    this.updateAccessibility();\n  }\n\n  #updateActiveHeader() {\n    if (this.#activeHeader !== this.#headerIndex.activeItem) {\n      this.#headerIndex.setActiveItem(this.#activeHeader);\n    }\n  }\n\n  #panelForHeader(header: BaseAccordionHeader) {\n    const next = header.nextElementSibling;\n    if (!BaseAccordion.isPanel(next)) {\n      return void this.#logger.error('Sibling element to a header needs to be a panel');\n    } else {\n      return next;\n    }\n  }\n\n  #expandHeader(header: BaseAccordionHeader, index = this.#getIndex(header)) {\n    // If this index is not already listed in the expandedSets array, add it\n    this.expandedSets.add(index);\n    this.#expandedIndex = [...this.expandedSets as Set<number>];\n    header.expanded = true;\n  }\n\n  #expandPanel(panel: BaseAccordionPanel) {\n    panel.expanded = true;\n    panel.hidden = false;\n  }\n\n  async #collapseHeader(header: BaseAccordionHeader, index = this.#getIndex(header)) {\n    if (!this.expandedSets) {\n      await this.updateComplete;\n    }\n    this.expandedSets.delete(index);\n    header.expanded = false;\n    await header.updateComplete;\n  }\n\n  async #collapsePanel(panel: BaseAccordionPanel) {\n    await panel.updateComplete;\n    if (!panel.expanded) {\n      return;\n    }\n\n    panel.expanded = false;\n    panel.hidden = true;\n  }\n\n  #onChange(event: AccordionHeaderChangeEvent) {\n    if (BaseAccordion.#isAccordionChangeEvent(event)) {\n      const index = this.#getIndex(event.target);\n      if (event.expanded) {\n        this.expand(index, event.accordion);\n      } else {\n        this.collapse(index);\n      }\n    }\n  }\n\n  #allHeaders(accordion: BaseAccordion = this): BaseAccordionHeader[] {\n    return Array.from(accordion.children).filter(BaseAccordion.isHeader);\n  }\n\n  #allPanels(accordion: BaseAccordion = this): BaseAccordionPanel[] {\n    return Array.from(accordion.children).filter(BaseAccordion.isPanel);\n  }\n\n  #getIndex(el: Element | null) {\n    if (BaseAccordion.isHeader(el)) {\n      return this.headers.findIndex(header => header.id === el.id);\n    }\n\n    if (BaseAccordion.isPanel(el)) {\n      return this.panels.findIndex(panel => panel.id === el.id);\n    }\n\n    this.#logger.warn('The #getIndex method expects to receive a header or panel element.');\n    return -1;\n  }\n\n  public updateAccessibility() {\n    this.#headerIndex.updateItems();\n    const { headers } = this;\n\n    // For each header in the accordion, attach the aria connections\n    headers.forEach(header => {\n      const panel = this.#panelForHeader(header);\n      if (panel) {\n        header.setAttribute('aria-controls', panel.id);\n        panel.setAttribute('aria-labelledby', header.id);\n        panel.hidden = !panel.expanded;\n      }\n    });\n  }\n\n  /**\n   * Accepts a 0-based index value (integer) for the set of accordion items to expand or collapse.\n   */\n  public async toggle(index: number) {\n    const { headers } = this;\n    const header = headers[index];\n\n    if (!header.expanded) {\n      await this.expand(index);\n    } else {\n      await this.collapse(index);\n    }\n  }\n\n  /**\n   * Accepts a 0-based index value (integer) for the set of accordion items to expand.\n   * Accepts an optional parent accordion to search for headers and panels.\n   */\n  public async expand(index: number, parentAccordion?: BaseAccordion) {\n    const allHeaders: Array<BaseAccordionHeader> = this.#allHeaders(parentAccordion);\n\n    const header = allHeaders[index];\n    if (!header) {\n      return;\n    }\n\n    const panel = this.#panelForHeader(header);\n    if (!panel) {\n      return;\n    }\n\n    // If the header and panel exist, open both\n    this.#expandHeader(header, index),\n    this.#expandPanel(panel),\n\n    header.focus();\n\n    this.dispatchEvent(new AccordionExpandEvent(header, panel));\n\n    await this.updateComplete;\n  }\n\n  /**\n   * Expands all accordion items.\n   */\n  public async expandAll() {\n    this.headers.forEach(header => this.#expandHeader(header));\n    this.panels.forEach(panel => this.#expandPanel(panel));\n    await this.updateComplete;\n  }\n\n  /**\n   * Accepts a 0-based index value (integer) for the set of accordion items to collapse.\n   */\n  public async collapse(index: number) {\n    const header = this.headers.at(index);\n    const panel = this.panels.at(index);\n\n    if (!header || !panel) {\n      return;\n    }\n\n    this.#collapseHeader(header);\n    this.#collapsePanel(panel);\n\n    this.dispatchEvent(new AccordionCollapseEvent(header, panel));\n    await this.updateComplete;\n  }\n\n  /**\n   * Collapses all accordion items.\n   */\n  public async collapseAll() {\n    this.headers.forEach(header => this.#collapseHeader(header));\n    this.panels.forEach(panel => this.#collapsePanel(panel));\n    await this.updateComplete;\n  }\n}\n"]}