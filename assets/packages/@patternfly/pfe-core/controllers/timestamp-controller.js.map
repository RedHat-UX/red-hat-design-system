{"version":3,"file":"timestamp-controller.js","sourceRoot":"","sources":["timestamp-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ReactiveController, ReactiveControllerHost } from 'lit';\n\nexport type DateTimeFormat = 'full' | 'long' | 'medium' | 'short';\n\nexport interface TimestampOptions {\n  dateFormat?: DateTimeFormat;\n  timeFormat?: DateTimeFormat;\n  customFormat?: Intl.DateTimeFormatOptions;\n  displaySuffix: string;\n  locale: Intl.LocalesArgument;\n  relative: boolean;\n  utc: boolean;\n  hour12: boolean;\n}\n\nconst defaults = {\n  dateFormat: undefined,\n  timeFormat: undefined,\n  customFormat: undefined,\n  displaySuffix: '',\n  locale: undefined,\n  relative: false,\n  utc: false,\n  hour12: false,\n} as const;\n\nexport class TimestampController implements ReactiveController {\n  static #isTimestampOptionKey(prop: PropertyKey): prop is keyof TimestampOptions {\n    return prop in defaults;\n  }\n\n  #date = new Date();\n\n  #options: TimestampOptions = {} as TimestampOptions;\n\n  #host: ReactiveControllerHost;\n\n  get localeString(): string {\n    return this.#date.toLocaleString(this.#options.locale);\n  }\n\n  get date(): Date {\n    return this.#date;\n  }\n\n  set date(string) {\n    this.#date = new Date(string);\n  }\n\n  get isoString(): string {\n    return this.#date.toISOString();\n  }\n\n  get time(): string {\n    if (this.#options.relative) {\n      return this.#getTimeRelative();\n    } else {\n      let { displaySuffix } = this.#options;\n      const { locale } = this.#options;\n      if (this.#options.utc) {\n        displaySuffix ||= 'UTC';\n      }\n      const localeString = this.#date.toLocaleString(locale, this.#options.customFormat ?? {\n        hour12: this.#options.hour12,\n        timeStyle: this.#options.timeFormat,\n        dateStyle: this.#options.dateFormat,\n        ...this.#options.utc && { timeZone: 'UTC' },\n      });\n\n      return `${localeString} ${displaySuffix ?? ''}`.trim();\n    }\n  }\n\n  constructor(host: ReactiveControllerHost, options?: Partial<TimestampOptions>) {\n    this.#host = host;\n    host.addController(this);\n    for (const [name, value] of Object.entries(this.#options)) {\n      // @ts-expect-error: seems typescript compiler isn't up to the task here\n      this.#options[name] = options?.[name] ?? value;\n    }\n  }\n\n  hostConnected?(): void;\n\n  /**\n   * Based off of Github Relative Time\n   * https://github.com/github/time-elements/blob/master/src/relative-time.js\n   */\n  #getTimeRelative() {\n    const date = this.#date;\n    const { locale } = this.#options;\n    const rtf = new Intl.RelativeTimeFormat(locale as string, {\n      localeMatcher: 'best fit',\n      numeric: 'auto',\n      style: 'long',\n    });\n    const ms: number = date.getTime() - Date.now();\n    const tense = ms > 0 ? 1 : -1;\n    let qty = 0;\n    let units: Intl.RelativeTimeFormatUnit | undefined;\n    const s = Math.round(Math.abs(ms) / 1000);\n    const min = Math.round(s / 60);\n    const h = Math.round(min / 60);\n    const d = Math.round(h / 24);\n    const m = Math.round(d / 30);\n    const y = Math.round(m / 12);\n    if (m >= 12) {\n      qty = y;\n      units = 'year';\n    } else if (d >= 30) {\n      qty = m;\n      units = 'month';\n    } else if (h >= 24) {\n      qty = d;\n      units = 'day';\n    } else if (min >= 45) {\n      qty = h;\n      units = 'hour';\n    } else if (s >= 45) {\n      qty = min;\n      units = 'minute';\n    } else if (s >= 10) {\n      qty = s;\n      units = 'second';\n    }\n\n    return typeof (units) !== 'undefined' ? rtf.format(tense * qty, units) : 'just now';\n  }\n\n  set(prop: PropertyKey, value: unknown): void {\n    if (TimestampController.#isTimestampOptionKey(prop)) {\n      // @ts-expect-error: seems typescript compiler isn't up to the task here\n      this.#options[prop] = value;\n      this.#host.requestUpdate();\n    }\n  }\n}\n"]}