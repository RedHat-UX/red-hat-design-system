{"version":3,"file":"internals-controller.js","sourceRoot":"","sources":["internals-controller.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  isServer,\n  type ReactiveController,\n  type ReactiveControllerHost,\n  type LitElement,\n} from 'lit';\n\nfunction isARIAMixinProp(key: string): key is keyof ARIAMixin {\n  return key === 'role' || key.startsWith('aria');\n}\n\ntype FACE = HTMLElement & {\n  formDisabledCallback?(disabled: boolean): void;\n};\n\nconst protos = new WeakMap();\n\nlet constructingAllowed = false;\n\ninterface InternalsControllerOptions extends Partial<ARIAMixin> {\n  getHTMLElement?(): HTMLElement;\n}\n\n/**\n * reactively forward the internals object's aria mixin prototype\n * @param target\n * @param key\n */\nfunction aria(\n  target: InternalsController,\n  key: keyof InternalsController,\n) {\n  if (!protos.has(target)) {\n    protos.set(target, new Set());\n  }\n  if (protos.get(target).has(key)) {\n    return;\n  }\n  if (!isARIAMixinProp(key)) {\n    throw new Error('@aria can only be called on ARIAMixin properties');\n  }\n  // typescript experimental decorator\n  Object.defineProperty(target, key, {\n    enumerable: true,\n    configurable: false,\n    get(this: InternalsController) {\n      // @ts-expect-error: because i'm bad, i'm bad\n      const internals = this.attachOrRetrieveInternals();\n      return internals[key];\n    },\n    set(this: InternalsController, value: string | null) {\n      // @ts-expect-error: ya know it!\n      const internals = this.attachOrRetrieveInternals();\n      // @ts-expect-error: shamone!\n      internals[key] = value;\n      this.host.requestUpdate();\n    },\n  });\n  protos.get(target).add(key);\n}\n\nfunction getLabelText(label: HTMLElement) {\n  if (label.hidden) {\n    return '';\n  } else {\n    const ariaLabel = label.getAttribute?.('aria-label');\n    return ariaLabel ?? label.textContent;\n  }\n}\n\nexport class InternalsController implements ReactiveController, ARIAMixin {\n  private static instances = new WeakMap<ReactiveControllerHost, InternalsController>();\n\n  declare readonly form: ElementInternals['form'];\n  declare readonly shadowRoot: ElementInternals['shadowRoot'];\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/ElementInternals/states\n  declare readonly states: unknown;\n  declare readonly willValidate: ElementInternals['willValidate'];\n  declare readonly validationMessage: ElementInternals['validationMessage'];\n\n  public static getLabels(host: ReactiveControllerHost): Element[] {\n    return Array.from(this.instances.get(host)?.internals.labels ?? []) as Element[];\n  }\n\n  public static isSafari: boolean =\n    !isServer && /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\n  public static of(\n    host: ReactiveControllerHost,\n    options?: InternalsControllerOptions,\n  ): InternalsController {\n    constructingAllowed = true;\n    // implement the singleton pattern\n    // using a public static constructor method is much easier to manage,\n    // due to the quirks of our typescript config\n    const instance: InternalsController =\n      InternalsController.instances.get(host)\n      ?? new InternalsController(host, options);\n    instance.initializeOptions(options);\n    constructingAllowed = false;\n    return instance;\n  }\n\n  @aria role: string | null = null;\n\n  @aria ariaActivedescendant: string | null = null;\n  @aria ariaAtomic: string | null = null;\n  @aria ariaAutoComplete: string | null = null;\n  @aria ariaBusy: string | null = null;\n  @aria ariaBrailleLabel: string | null = null;\n  @aria ariaBrailleRoleDescription: string | null = null;\n  @aria ariaChecked: string | null = null;\n  @aria ariaColCount: string | null = null;\n  @aria ariaColIndex: string | null = null;\n  @aria ariaColIndexText: string | null = null;\n  @aria ariaColSpan: string | null = null;\n  @aria ariaCurrent: string | null = null;\n  @aria ariaDescription: string | null = null;\n  @aria ariaDisabled: string | null = null;\n  @aria ariaExpanded: string | null = null;\n  @aria ariaHasPopup: string | null = null;\n  @aria ariaHidden: string | null = null;\n  @aria ariaInvalid: string | null = null;\n  @aria ariaKeyShortcuts: string | null = null;\n  @aria ariaLabel: string | null = null;\n  @aria ariaLevel: string | null = null;\n  @aria ariaLive: string | null = null;\n  @aria ariaModal: string | null = null;\n  @aria ariaMultiLine: string | null = null;\n  @aria ariaMultiSelectable: string | null = null;\n  @aria ariaOrientation: string | null = null;\n  @aria ariaPlaceholder: string | null = null;\n  @aria ariaPosInSet: string | null = null;\n  @aria ariaPressed: string | null = null;\n  @aria ariaReadOnly: string | null = null;\n  @aria ariaRequired: string | null = null;\n  @aria ariaRoleDescription: string | null = null;\n  @aria ariaRowCount: string | null = null;\n  @aria ariaRowIndex: string | null = null;\n  @aria ariaRowIndexText: string | null = null;\n  @aria ariaRowSpan: string | null = null;\n  @aria ariaSelected: string | null = null;\n  @aria ariaSetSize: string | null = null;\n  @aria ariaSort: string | null = null;\n  @aria ariaValueMax: string | null = null;\n  @aria ariaValueMin: string | null = null;\n  @aria ariaValueNow: string | null = null;\n  @aria ariaValueText: string | null = null;\n\n  /** WARNING: be careful of cross-root ARIA browser support */\n  @aria ariaActiveDescendantElement: Element | null = null;\n  /** WARNING: be careful of cross-root ARIA browser support */\n  @aria ariaControlsElements: Element[] | null = null;\n  /** WARNING: be careful of cross-root ARIA browser support */\n  @aria ariaDescribedByElements: Element[] | null = null;\n  /** WARNING: be careful of cross-root ARIA browser support */\n  @aria ariaDetailsElements: Element[] | null = null;\n  /** WARNING: be careful of cross-root ARIA browser support */\n  @aria ariaErrorMessageElements: Element[] | null = null;\n  /** WARNING: be careful of cross-root ARIA browser support */\n  @aria ariaFlowToElements: Element[] | null = null;\n  /** WARNING: be careful of cross-root ARIA browser support */\n  @aria ariaLabelledByElements: Element[] | null = null;\n  /** WARNING: be careful of cross-root ARIA browser support */\n  @aria ariaOwnsElements: Element[] | null = null;\n\n  /** True when the control is disabled via it's containing fieldset element */\n  get formDisabled(): boolean {\n    if (isServer) {\n      return this._formDisabled;\n    } else {\n      return this.element?.matches(':disabled') || this._formDisabled;\n    }\n  }\n\n  get labels(): NodeList {\n    return this.internals.labels;\n  }\n\n  get validity(): ValidityState {\n    return this.internals.validity;\n  }\n\n  /** A best-attempt based on observed behaviour in FireFox 115 on fedora 38 */\n  get computedLabelText(): string {\n    return this.internals.ariaLabel\n      || Array.from(this.internals.labels as NodeListOf<HTMLElement>)\n          .reduce((acc, label) =>\n            `${acc}${getLabelText(label)}`, '');\n  }\n\n  private get element() {\n    if (isServer) {\n      // FIXME(bennyp): a little white lie, which may break\n      // when the controller is applied to non-lit frameworks.\n      return this.host as LitElement;\n    } else {\n      return this.host instanceof HTMLElement ? this.host : this.options?.getHTMLElement?.();\n    }\n  }\n\n  private internals!: ElementInternals;\n\n  private _formDisabled = false;\n\n  private constructor(\n    public host: ReactiveControllerHost,\n    private options?: InternalsControllerOptions,\n  ) {\n    if (!constructingAllowed) {\n      throw new Error('InternalsController must be constructed with `InternalsController.for()`');\n    }\n    if (!this.element) {\n      throw new Error(\n        `InternalsController must be instantiated with an HTMLElement or a \\`getHTMLElement\\` function`,\n      );\n    }\n    this.attachOrRetrieveInternals();\n    this.initializeOptions(options);\n    InternalsController.instances.set(host, this);\n    this.#polyfillDisabledPseudo();\n  }\n\n  /**\n   * We need to polyfill :disabled\n   * see https://github.com/calebdwilliams/element-internals-polyfill/issues/88\n   */\n  #polyfillDisabledPseudo() {\n    // START polyfill-disabled\n    // We need to polyfill :disabled\n    // see https://github.com/calebdwilliams/element-internals-polyfill/issues/88\n    const orig = (this.element as FACE).formDisabledCallback;\n    (this.element as FACE).formDisabledCallback = disabled => {\n      this._formDisabled = disabled;\n      orig?.call(this.host, disabled);\n    // END polyfill-disabled\n    };\n  }\n\n  /**\n   * Typescript (with experimental decorators) will compile the class\n   * such that the order of operations is:\n   * 1. set up constructor parameter fields\n   * 2. run decorated field setters with initializers as the value\n   * 3. run the rest of the constructor\n   * Because of that, `this.internals` may not be available in the decorator setter\n   * so we cheat here with nullish coalescing assignment operator `??=`;\n   */\n  private attachOrRetrieveInternals() {\n    this.internals ??= this.element!.attachInternals();\n    return this.internals;\n  }\n\n  private initializeOptions(options?: Partial<ARIAMixin>) {\n    this.options ??= options ?? {};\n    const { getHTMLElement, ...aria } = this.options;\n    this.options.getHTMLElement ??= getHTMLElement;\n    for (const [key, val] of Object.entries(aria)) {\n      if (isARIAMixinProp(key)) {\n        this[key as keyof this] = val as this[keyof this];\n      }\n    }\n  }\n\n  hostConnected?(): void;\n\n  setFormValue(...args: Parameters<ElementInternals['setFormValue']>): void {\n    return this.internals.setFormValue(...args);\n  }\n\n  setValidity(...args: Parameters<ElementInternals['setValidity']>): void {\n    return this.internals.setValidity(...args);\n  }\n\n  checkValidity(...args: Parameters<ElementInternals['checkValidity']>): boolean {\n    return this.internals.checkValidity(...args);\n  }\n\n  reportValidity(...args: Parameters<ElementInternals['reportValidity']>): boolean {\n    return this.internals.reportValidity(...args);\n  }\n\n  submit(): void {\n    this.internals.form?.requestSubmit();\n  }\n\n  reset(): void {\n    this.internals.form?.reset();\n  }\n}\n\n/** @see https://w3c.github.io/aria/#ref-for-dom-ariamixin-ariaactivedescendantelement-1 */\ndeclare global {\n  interface ARIAMixin {\n    ariaActiveDescendantElement: Element | null;\n    ariaControlsElements: readonly Element[] | null;\n    ariaDescribedByElements: readonly Element[] | null;\n    ariaDetailsElements: readonly Element[] | null;\n    ariaErrorMessageElements: readonly Element[] | null;\n    ariaFlowToElements: readonly Element[] | null;\n    ariaLabelledByElements: readonly Element[] | null;\n    ariaOwnsElements: readonly Element[] | null;\n  }\n}\n"]}