{"version":3,"file":"uxdot-pattern-ssr-controller-client.js","sourceRoot":"","sources":["uxdot-pattern-ssr-controller-client.ts"],"names":[],"mappings":"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","sourcesContent":["import { RHDSSSRController } from '@rhds/elements/lib/ssr-controller.js';\nimport { noChange, type LitElement } from 'lit';\nimport { unsafeHTML } from 'lit/directives/unsafe-html.js';\n\n/** Hydrate the results of SSR on the client */\nexport class UxdotPatternSSRControllerClient extends RHDSSSRController {\n  allContent: ReturnType<typeof unsafeHTML> | typeof noChange = noChange;\n  htmlContent: ReturnType<typeof unsafeHTML> | typeof noChange = noChange;\n  jsContent: ReturnType<typeof unsafeHTML> | typeof noChange = noChange;\n  cssContent: ReturnType<typeof unsafeHTML> | typeof noChange = noChange;\n  hasCss: boolean | typeof noChange = noChange;\n  hasJs: boolean | typeof noChange = noChange;\n  hasWorkedAroundHydrationWoes = false;\n\n  /**\n   * Extract content from SSR-rendered shadow DOM before hydration.\n   * Runs synchronously during connectedCallback (before the first update)\n   * to provide hydration-compatible unsafeHTML directive values instead of\n   * noChange primitives, which cause \"Primitive found where TemplateResult\n   * expected\" hydration errors.\n   */\n  #extractSSRContent() {\n    const root = this.host.shadowRoot;\n    if (!root) {\n      return;\n    }\n\n    const surface = root.querySelector('#content');\n    if (surface) {\n      // Strip Lit SSR hydration comment markers\n      const content = surface.innerHTML.replace(/<!--\\/?lit-[^>]*-->/g, '').trim();\n      if (content) {\n        this.allContent = unsafeHTML(content);\n      }\n    }\n\n    // Extract highlighted code from each tab's code block\n    for (const [panel, prop] of [\n      ['#html-panel', 'htmlContent'],\n      ['#css-panel', 'cssContent'],\n      ['#js-panel', 'jsContent'],\n    ] satisfies readonly [string, keyof this][]) {\n      const pre = root.querySelector(`${panel} rh-code-block pre`);\n      if (pre) {\n        this[prop] = unsafeHTML(pre.outerHTML);\n      }\n    }\n\n    this.hasCss = !!root.querySelector('#css-panel rh-code-block pre')?.textContent?.trim();\n    this.hasJs = !!root.querySelector('#js-panel rh-code-block pre')?.textContent?.trim();\n  }\n\n  async hostConnected() {\n    // Extract SSR content synchronously BEFORE the first update/hydration.\n    // This provides unsafeHTML() directive values instead of noChange primitives,\n    // ensuring forceRender recovery (if hydration fails) has content to work with.\n    this.#extractSSRContent();\n\n    await this.host.updateComplete;\n    this.host.requestUpdate('colorPalette', null);\n    this.host.requestUpdate('activeTab', null);\n    await this.host.updateComplete;\n    // workaround for awful terrible no good very bad ssr hydration lib problems\n    const containers = this.host.shadowRoot!.querySelectorAll('#container');\n    if (containers.length > 1) {\n      // Keep the LAST container (Lit-managed with proper bindings and content);\n      // remove earlier containers (SSR with broken hydration state)\n      const last = containers[containers.length - 1];\n      for (const container of containers) {\n        if (container !== last) {\n          container.remove();\n        }\n      }\n      for (const sigh of this.host.shadowRoot!.querySelectorAll('[defer-hydration]')) {\n        sigh.removeAttribute('defer-hydration');\n        (sigh as LitElement).requestUpdate?.();\n      }\n      this.host.requestUpdate();\n    }\n    this.hasWorkedAroundHydrationWoes ||= (this.host.requestUpdate(), true);\n  }\n\n  hostUpdated() {\n    if (!this.hasWorkedAroundHydrationWoes) {\n      this.hostConnected();\n    }\n  }\n}\n"]}