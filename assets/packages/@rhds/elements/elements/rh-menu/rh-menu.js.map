{"version":3,"file":"rh-menu.js","sourceRoot":"","sources":["rh-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html, isServer } from 'lit';\nimport { customElement } from 'lit/decorators/custom-element.js';\nimport { queryAssignedElements } from 'lit/decorators/query-assigned-elements.js';\n\nimport { getRandomId } from '@patternfly/pfe-core/functions/random.js';\nimport { RovingTabindexController } from '@patternfly/pfe-core/controllers/roving-tabindex-controller.js';\nimport { InternalsController } from '@patternfly/pfe-core/controllers/internals-controller.js';\n\nimport { themable } from '@rhds/elements/lib/themable.js';\nimport { RhMenuItem } from './rh-menu-item.js';\nimport { RhMenuItemGroup } from './rh-menu-item-group.js';\n\nimport styles from './rh-menu.css';\n\nexport class MenuToggleEvent extends Event {\n  constructor(\n    public open: boolean,\n    public menu: HTMLElement\n  ) {\n    super('toggle', { bubbles: true });\n  }\n}\n\n/**\n * Menu\n *\n * @alias menu\n */\n@customElement('rh-menu')\n@themable\nexport class RhMenu extends LitElement {\n  static readonly styles = [styles];\n\n  static shadowRootOptions = { ...LitElement.shadowRootOptions, delegatesFocus: true };\n\n  @queryAssignedElements() private _menuItems!: HTMLElement[];\n  #items!: HTMLElement[];\n\n  #tabindex: RovingTabindexController<HTMLElement> = RovingTabindexController.of(this, {\n    getItems: () => this.getItems(this.#items ? this.#items : this._menuItems),\n  });\n\n  // eslint-disable-next-line no-unused-private-class-members\n  #internals = InternalsController.of(this, { role: 'menubar' });\n\n  /**\n   * override or set to add items to the roving tab index controller\n   * @param items original list of items\n   */\n  getItems(items: HTMLElement[]): HTMLElement[] {\n    return items;\n  }\n\n  get activeItem() {\n    return this.#tabindex.items.at(this.#tabindex.atFocusedItemIndex);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.id ||= getRandomId('menu');\n    this.#onSlotchange();\n  }\n\n  render() {\n    return html`\n      <!-- menu items -->\n      <slot @slotchange=\"${this.#onSlotchange}\" part=\"menu\"></slot>\n    `;\n  }\n\n  #onSlotchange() {\n    if (!isServer) {\n      this.#items = this._menuItems.flatMap((element: Element) => {\n        if (element instanceof HTMLSlotElement) {\n          const assigned = element.assignedElements().filter(\n            (el): el is HTMLElement => !(el instanceof HTMLHRElement)\n          );\n\n          const items = assigned.flatMap(el => {\n            if (el instanceof RhMenuItemGroup) {\n              return Array.from(el.querySelectorAll('rh-menu-item'));\n            }\n            return [el];\n          });\n\n          return items;\n        } else {\n          if (element instanceof HTMLHRElement) {\n            // Skip <hr> elements\n            return [];\n          }\n\n          if (element instanceof RhMenuItem) {\n            return [element];\n          } else if (element instanceof RhMenuItemGroup) {\n            return Array.from(element.querySelectorAll('rh-menu-item'));\n          } else if (element instanceof HTMLElement) {\n            if (!element.hasAttribute('role')) {\n              element.setAttribute('role', 'menuitem');\n            }\n            return [element];\n          } else {\n            return [];\n          }\n        }\n      });\n\n      this.#tabindex.hostUpdate();\n    }\n  }\n\n  activateItem(item: HTMLElement) {\n    this.#tabindex.atFocusedItemIndex = this.#tabindex.items.indexOf(item);\n  }\n\n  focus() {\n    this.#tabindex.items[this.#tabindex.atFocusedItemIndex]?.focus();\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rh-menu': RhMenu;\n  }\n}\n"]}