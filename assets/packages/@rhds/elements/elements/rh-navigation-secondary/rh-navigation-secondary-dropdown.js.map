{"version":3,"file":"rh-navigation-secondary-dropdown.js","sourceRoot":"","sources":["rh-navigation-secondary-dropdown.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, isServer, LitElement } from 'lit';\nimport { customElement } from 'lit/decorators/custom-element.js';\nimport { state } from 'lit/decorators/state.js';\nimport { query } from 'lit/decorators/query.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport { ComposedEvent } from '@patternfly/pfe-core';\nimport { Logger } from '@patternfly/pfe-core/controllers/logger.js';\nimport { bound, observes } from '@patternfly/pfe-core/decorators.js';\nimport { SlotController } from '@patternfly/pfe-core/controllers/slot-controller.js';\nimport { getRandomId } from '@patternfly/pfe-core/functions/random.js';\n\nimport { RhNavigationSecondaryMenu } from './rh-navigation-secondary-menu.js';\n\nexport class SecondaryNavDropdownExpandEvent extends ComposedEvent {\n  constructor(\n    public expanded: boolean,\n    public toggle: RhNavigationSecondaryDropdown,\n  ) {\n    super('expand-request');\n  }\n}\n\n// There is possibility of abstracting this component to a more 'generic' standalone component\n// in the future. Styles or functionality that are specific to rh-navigation-secondary are commented\n// on as such for any future abstraction.\n\nimport styles from './rh-navigation-secondary-dropdown.css';\n\n/**\n * Upgrades a top level nav link to include dropdown functionality\n * @summary Upgrades a top level nav link to include dropdown functionality\n * @slot link   - Link for dropdown, expects `<a>` element\n * @slot menu   - Menu for dropdown, expects `<rh-navigation-secondary-menu>` element\n * @fires { SecondaryNavDropdownExpandEvent } change - Fires when a dropdown is clicked\n */\n@customElement('rh-navigation-secondary-dropdown')\nexport class RhNavigationSecondaryDropdown extends LitElement {\n  static readonly styles = [styles];\n\n  #slots = new SlotController(this, { slots: ['link', 'menu'] });\n\n  #logger = new Logger(this);\n\n  #highlight = false;\n\n  #mo = new MutationObserver(this.#mutationsCallback.bind(this));\n\n  @query('#container') _container?: HTMLElement;\n\n  @state() expanded = false;\n\n  connectedCallback(): void {\n    super.connectedCallback();\n\n    this.id ||= getRandomId('rh-navigation-secondary-dropdown');\n\n    this.#mo.observe(this, { attributeFilter: ['aria-current'], childList: true, subtree: true });\n    if (!isServer) {\n      this.#upgradeAccessibility();\n      this.#mutationsCallback();\n    }\n  }\n\n  render() {\n    const classes = { 'expanded': this.expanded, 'highlight': this.#highlight };\n\n    return html`\n      <div id=\"container\" part=\"container\" class=\"${classMap(classes)}\">\n        <slot name=\"link\"></slot>\n        <slot name=\"menu\"></slot>\n      </div>\n    `;\n  }\n\n  /**\n   * When expanded property changes, check the new value, if true\n   * run the `#open()` method, if false run the `#close()` method.\n   * @param oldVal {string} - Boolean value in string form\n   * @param newVal {string} - Boolean value in string form\n   */\n  @observes('expanded')\n  protected _expandedChanged(oldVal?: 'false' | 'true', newVal?: 'false' | 'true'): void {\n    if (newVal === oldVal) {\n      return;\n    }\n    return newVal ? this.#open() : this.#close();\n  }\n\n  /**\n   * When a dropdown is clicked set expanded to the opposite of the expanded property\n   * and then dispatch that value in a SecondaryNavDropdownExpandEvent\n   * @param event {MouseEvent}\n   */\n  @bound\n  private _clickHandler(event: MouseEvent) {\n    event.preventDefault();\n    this.expanded = !this.expanded;\n    // trigger change event which evokes the mutation on this.expanded\n    this.dispatchEvent(new SecondaryNavDropdownExpandEvent(this.expanded, this));\n  }\n\n  /**\n   * Sets or removes attributes needed to open a dropdown menu\n   */\n  #open(): void {\n    const link = this.#slots.getSlotted('link').find(child => child instanceof HTMLAnchorElement);\n    link?.setAttribute('aria-expanded', 'true');\n    // menu as a RhNavigationSecondaryMenu in the slotted child is specific to rh-navigation-secondary.\n    // If this component is abstracted to a standalone component. The RhNavigationSecondaryMenu\n    // could possibly become a sub component of the abstraction instead.\n    const menu = this.#slots.getSlotted('menu').find(child =>\n      child instanceof RhNavigationSecondaryMenu\n    ) as RhNavigationSecondaryMenu;\n    menu.visible = true;\n  }\n\n  /** Sets or removes attributes needed to close a dropdown menu */\n  #close() {\n    const link = this.#slots.getSlotted('link').find(child => child instanceof HTMLAnchorElement);\n    link?.setAttribute('aria-expanded', 'false');\n    // Same as comment in #open()\n    // The RhNavigationSecondaryMenu could possibly become a sub component of the abstraction instead.\n    const menu = this.#slots.getSlotted('menu').find(\n      (child: Node): child is RhNavigationSecondaryMenu =>\n        child instanceof RhNavigationSecondaryMenu);\n    if (menu) {\n      menu.visible = false;\n    }\n  }\n\n  async #mutationsCallback(): Promise<void> {\n    const [menu] = this.#slots.getSlotted<HTMLElement>('menu');\n    this.#highlight = menu.querySelector('[aria-current=\"page\"]') ? true : false;\n    this.requestUpdate();\n  }\n\n  #upgradeAccessibility() {\n    const [link] = this.#slots.getSlotted<HTMLElement>('link');\n    const [menu] = this.#slots.getSlotted<HTMLElement>('menu');\n    if (link === undefined) {\n      this.#logger.warn(\n        '[rh-navigation-secondary-dropdown][slot=\"link\"] expects a slotted <a> tag'\n      );\n      return;\n    }\n    if (menu === undefined) {\n      this.#logger.warn(`[rh-navigation-secondary-dropdown][slot=\"menu\"] expects a slotted <rh-navigation-secondary-menu> tag`);\n      return;\n    }\n\n    link.setAttribute('role', 'button');\n    link.setAttribute('aria-expanded', 'false');\n    link.setAttribute('aria-controls', menu.id);\n    link.addEventListener('click', this._clickHandler);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rh-navigation-secondary-dropdown': RhNavigationSecondaryDropdown;\n  }\n}\n"]}