{"version":3,"file":"rh-transcript.js","sourceRoot":"","sources":["rh-transcript.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html } from 'lit';\nimport { customElement } from 'lit/decorators/custom-element.js';\nimport { property } from 'lit/decorators/property.js';\nimport { state } from 'lit/decorators/state.js';\nimport { queryAssignedElements } from 'lit/decorators/query-assigned-elements.js';\n\nimport { RhCue, getFormattedTime } from './rh-cue.js';\n\nimport { HeadingLevelContextConsumer } from '@rhds/elements/lib/context/headings/consumer.js';\nimport { HeadingLevelContextProvider } from '@rhds/elements/lib/context/headings/provider.js';\n\nimport buttonStyles from './rh-audio-player-button.css';\nimport panelStyles from './rh-audio-player-panel.css';\nimport styles from './rh-transcript.css';\n\nimport './rh-audio-player-scrolling-text-overflow.js';\n\nimport '@rhds/elements/rh-tooltip/rh-tooltip.js';\nimport '@rhds/elements/rh-icon/rh-icon.js';\n\n/**\n * Audio Player Transcript Panel\n * @slot heading - custom heading for panel\n * @slot - `rh-cue` elements\n * @csspart heading - scrolling text overflow\n * @csspart toolbar - toolbar area above cues list\n */\n@customElement('rh-transcript')\nexport class RhTranscript extends LitElement {\n  static readonly styles = [buttonStyles, panelStyles, styles];\n\n  @property() heading?: string;\n\n  @property() label?: string;\n\n  @property({ reflect: true }) lang!: string;\n\n  @state() private _label!: string;\n\n  @state() private _autoscroll!: string;\n\n  @state() private _download!: string;\n\n  @queryAssignedElements({ selector: 'rh-cue' })\n  private _cues!: RhCue[];\n\n  #autoscroll = true;\n\n  #duration?: number;\n\n  #headings = new HeadingLevelContextProvider(this, {\n    offset: 0,\n    parent: new HeadingLevelContextConsumer(this),\n  });\n\n  set autoscrollLabel(label: string) {\n    this._autoscroll = label;\n  }\n\n  get autoscrollLabel(): string {\n    return this._autoscroll || 'Autoscroll';\n  }\n\n  set downloadLabel(label: string) {\n    this._download = label;\n  }\n\n  get downloadLabel(): string {\n    return this._download || 'Download';\n  }\n\n  get downloadText() {\n    return this._cues.map(cue =>cue.downloadText).join('\\n\\n');\n  }\n\n  set menuLabel(label: string) {\n    this._label = label;\n  }\n\n  get menuLabel(): string {\n    return this.label || this._label || 'About the episode';\n  }\n\n  render() {\n    return html`\n      <rh-audio-player-scrolling-text-overflow part=\"heading\">\n        <slot name=\"heading\">${this.#headings.wrap(this.menuLabel)}</slot>\n      </rh-audio-player-scrolling-text-overflow>\n      <div class=\"panel-toolbar\" part=\"toolbar\">${this._cues.length < 0 ? '' : html`\n        <label>\n          <input id=\"autoscroll\"\n                 type=\"checkbox\"\n                 ?checked=\"${this.#autoscroll}\"\n                 @click=\"${this.#onScrollClick}\">\n            ${this.autoscrollLabel}\n        </label>\n        <rh-tooltip id=\"download-tooltip\">\n          <button id=\"download\" @click=\"${this.#onDownloadClick}\" aria-label=\"${this.downloadLabel}\">\n            <rh-icon set=\"ui\" icon=\"download\"></rh-icon>\n          </button>\n          <span slot=\"content\">${this.downloadLabel}</span>\n        </rh-tooltip>`}\n      </div>\n      <slot id=\"cues\"></slot>\n    `;\n  }\n\n  #updateCues(currentTime?: number) {\n    let activeCue: RhCue;\n    this._cues.forEach((cue, index)=>{\n      if (!cue.start) {\n        const prevCue = this._cues[index - 1];\n        const prevEnd = prevCue?.end;\n        if (prevEnd) {\n          cue.start = prevEnd || '0:00';\n        }\n      }\n      if (!cue.end) {\n        const nextCue = this._cues[index + 1];\n        const nextStart = nextCue?.start;\n        const duration = getFormattedTime(this.#duration);\n        if (!!nextStart || !!duration) {\n          cue.end = nextStart || duration;\n        }\n      }\n      if (currentTime) {\n        const started = !!cue.startTime\n          && Math.round(cue.startTime) < Math.round(currentTime) ?\n          true : false;\n        const ended = !!cue.endTime\n          && Math.round(cue.endTime) < Math.round(currentTime) ?\n          true : false;\n        const active = started && !ended;\n        cue.active = active;\n        if (active) {\n          activeCue = cue;\n        }\n      }\n\n      const cuesContainer = this.shadowRoot?.getElementById('cues');\n\n      if (activeCue && this.#autoscroll && !!cuesContainer) {\n        const anchor = activeCue.offsetTop + (0.5 * activeCue.offsetHeight);\n        const scroll = anchor - cuesContainer.offsetTop - (0.5 * cuesContainer?.offsetHeight);\n\n        setTimeout(() => {\n          if (cuesContainer) {\n            cuesContainer.scrollTop = scroll;\n          }\n        }, 250);\n      }\n    });\n  }\n\n  #onScrollClick() {\n    this.#autoscroll = !this.#autoscroll;\n    this.requestUpdate();\n  }\n\n  #onDownloadClick() {\n    this.dispatchEvent(new Event('transcriptdownload', { bubbles: true }));\n  }\n\n  setActiveCues(currentTime = 0) {\n    this.#updateCues(currentTime);\n  }\n\n  setDuration(mediaDuration: number) {\n    if (!!mediaDuration && this.#duration !== mediaDuration) {\n      this.#duration = mediaDuration;\n      this.requestUpdate();\n      this.#updateCues();\n    }\n  }\n\n  scrollText() {\n    this.shadowRoot?.querySelector('rh-audio-player-scrolling-text-overflow')?.startScrolling();\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rh-transcript': RhTranscript;\n  }\n}\n"]}