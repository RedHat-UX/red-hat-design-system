{"version":3,"file":"rh-transcript.js","sourceRoot":"","sources":["rh-transcript.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html, type TemplateResult } from 'lit';\nimport { customElement } from 'lit/decorators/custom-element.js';\nimport { property } from 'lit/decorators/property.js';\nimport { state } from 'lit/decorators/state.js';\n\nimport { RhCue, getFormattedTime } from './rh-cue.js';\n\nimport { HeadingLevelContextConsumer } from '@rhds/elements/lib/context/headings/consumer.js';\nimport { HeadingLevelContextProvider } from '@rhds/elements/lib/context/headings/provider.js';\nimport { SlotController } from '@patternfly/pfe-core/controllers/slot-controller-server.js';\n\nimport buttonStyles from './rh-audio-player-button.css';\nimport panelStyles from './rh-audio-player-panel.css';\nimport styles from './rh-transcript.css';\n\nimport './rh-audio-player-scrolling-text-overflow.js';\n\nimport '@rhds/elements/rh-tooltip/rh-tooltip.js';\nimport '@rhds/elements/rh-icon/rh-icon.js';\n\n/**\n * Audio Player Transcript Panel\n */\n@customElement('rh-transcript')\nexport class RhTranscript extends LitElement {\n  static readonly styles = [buttonStyles, panelStyles, styles];\n\n  @property() heading?: string;\n\n  @property() label?: string;\n\n  @property({ reflect: true }) lang!: string;\n\n  @property() menuLabel = 'About the episode';\n  @property() downloadLabel = 'Download';\n  @property() autoscrollLabel = 'Autoscroll';\n\n  @state() private _autoscroll!: string;\n\n  @state() private _download!: string;\n\n  #autoscroll = true;\n\n  #duration?: number;\n\n  #slots = new SlotController(this, 'heading', null, 'cues');\n\n  #headings = new HeadingLevelContextConsumer(this);\n\n  get downloadText() {\n    return this.#slots.getSlotted<RhCue>('cues').map(cue =>cue.downloadText).join('\\n\\n');\n  }\n\n  constructor() {\n    super();\n    new HeadingLevelContextProvider(this, { offset: 0 });\n  }\n\n  override render(): TemplateResult {\n    return html`\n      <!-- scrolling text overflow -->\n      <rh-audio-player-scrolling-text-overflow part=\"heading\">\n        <!-- custom heading for panel -->\n        <slot name=\"heading\">${this.#headings.wrap(this.menuLabel)}</slot>\n      </rh-audio-player-scrolling-text-overflow>\n      <!-- toolbar area above cues list -->\n      <div class=\"panel-toolbar\" part=\"toolbar\">${this.#slots.isEmpty('cues') ? '' : html`\n        <label>\n          <input id=\"autoscroll\"\n                 type=\"checkbox\"\n                 ?checked=\"${this.#autoscroll}\"\n                 @click=\"${this.#onScrollClick}\">\n            ${this.autoscrollLabel}\n        </label>\n        <rh-tooltip id=\"download-tooltip\">\n          <button id=\"download\" @click=\"${this.#onDownloadClick}\" aria-label=\"${this.downloadLabel}\">\n            <rh-icon set=\"ui\" icon=\"download\"></rh-icon>\n          </button>\n          <span slot=\"content\">${this.downloadLabel}</span>\n        </rh-tooltip>`}\n      </div>\n      <!-- \\`rh-cue\\` elements -->\n      <slot id=\"cues\"></slot>\n    `;\n  }\n\n  #updateCues(currentTime?: number) {\n    let activeCue: RhCue;\n    this.#slots.getSlotted<RhCue>('cues').forEach((cue, index, a)=>{\n      if (!cue.start) {\n        const prevCue = a[index - 1];\n        const prevEnd = prevCue?.end;\n        if (prevEnd) {\n          cue.start = prevEnd || '0:00';\n        }\n      }\n      if (!cue.end) {\n        const nextCue = a[index + 1];\n        const nextStart = nextCue?.start;\n        const duration = getFormattedTime(this.#duration);\n        if (!!nextStart || !!duration) {\n          cue.end = nextStart || duration;\n        }\n      }\n      if (currentTime) {\n        const started = !!cue.startTime\n          && Math.round(cue.startTime) < Math.round(currentTime) ?\n          true : false;\n        const ended = !!cue.endTime\n          && Math.round(cue.endTime) < Math.round(currentTime) ?\n          true : false;\n        const active = started && !ended;\n        cue.active = active;\n        if (active) {\n          activeCue = cue;\n        }\n      }\n\n      const cuesContainer = this.shadowRoot?.getElementById('cues');\n\n      if (activeCue && this.#autoscroll && !!cuesContainer) {\n        const anchor = activeCue.offsetTop + (0.5 * activeCue.offsetHeight);\n        const scroll = anchor - cuesContainer.offsetTop - (0.5 * cuesContainer?.offsetHeight);\n\n        setTimeout(() => {\n          if (cuesContainer) {\n            cuesContainer.scrollTop = scroll;\n          }\n        }, 250);\n      }\n    });\n  }\n\n  #onScrollClick() {\n    this.#autoscroll = !this.#autoscroll;\n    this.requestUpdate();\n  }\n\n  #onDownloadClick() {\n    this.dispatchEvent(new Event('transcriptdownload', { bubbles: true }));\n  }\n\n  setActiveCues(currentTime = 0) {\n    this.#updateCues(currentTime);\n  }\n\n  setDuration(mediaDuration: number) {\n    if (!!mediaDuration && this.#duration !== mediaDuration) {\n      this.#duration = mediaDuration;\n      this.requestUpdate();\n      this.#updateCues();\n    }\n  }\n\n  scrollText() {\n    this.shadowRoot?.querySelector('rh-audio-player-scrolling-text-overflow')?.startScrolling();\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rh-transcript': RhTranscript;\n  }\n}\n"]}