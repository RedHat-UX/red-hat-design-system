{"version":3,"file":"rh-cue.js","sourceRoot":"","sources":["rh-cue.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html, nothing } from 'lit';\nimport { customElement } from 'lit/decorators/custom-element.js';\nimport { property } from 'lit/decorators/property.js';\n\nimport { HeadingLevelContextConsumer } from '../../lib/context/headings/consumer.js';\n\nimport styles from './rh-cue.css';\n\nexport type Seconds = (number | null | undefined);\nexport type TimeString = (string | null | undefined);\n\n/**\n * formats time in seconds as `mm:ss.ms` string\n */\nexport const getFormattedTime = (seconds: Seconds): string => {\n  const ss = seconds ?? 0;\n  return (\n      typeof seconds === 'undefined' ? ''\n    : `${Math.floor(ss % 3600 / 60).toString().padStart(2, '0')}:${Math.floor(ss % 60).toString().padStart(2, '0')}`\n  );\n};\n\n\n/**\n * non-capturing group (_optional_):\n * > named capture group 1 `hh`:\n * > > **0-9** (_2x_)\n * > `:`\n * non-capturing group:\n * > named capture group 2 `mm`:\n * > > **0-9** (_2x_)\n * > `:`\n * named capture group 3 `ss`:\n * > **0-9** (_2x_)\n * non-capturing group (_optional_):\n * > `.`\n * > named capture group 4 `ms`:\n * > > **0-9** (_>= 1x_)\n */\nconst SECONDS_RE = /(?:(?<hh>\\d{2}):)?(?:(?<mm>\\d{2}):)(?<ss>\\d{2})(?:\\.(?<ms>\\d+))?/;\n\n/**\n * gets seconds from a string formatted as `mm:ss.mss` or `hh:mm:ss.mss`\n */\nexport const getSeconds = (str: TimeString): Seconds => {\n  if (!str) {\n    return undefined;\n  }\n  const match = str.match(SECONDS_RE);\n  if (!match) {\n    return undefined;\n  } else {\n    const { hh = 0, mm = 0, ss = 0, ms = 0 } = match.groups ?? {};\n    return (hh as number * 3600) + (mm as number * 60) + (ss as number * 1) + (ms as number / 1000);\n  }\n};\n\n/**\n * Media Transcript Cue\n * @slot - text of cue\n * @fires cueseek - when user clicks a time cue\n */\n@customElement('rh-cue')\nexport class RhCue extends LitElement {\n  static readonly styles = [styles];\n\n  /** Start time, in mm:ss.ms */\n  @property() start?: string;\n\n  /** End time, in mm:ss.ms */\n  @property() end?: string;\n\n  /** Text of this cue. Overridden by `text` slot */\n  @property() text?: string;\n\n  /** Name of voice speaking this text. Overridden by `voice` slot */\n  @property({ reflect: true }) voice?: string;\n\n  /** Whether this cue is active right now */\n  @property({ type: Boolean, reflect: true }) active = false;\n\n  #headings = new HeadingLevelContextConsumer(this);\n\n  get #hasVoice() {\n    return !!this.voice && this.voice.trim()?.length > 0;\n  }\n\n  get startTime() {\n    return this.start ? getSeconds(this.start) : undefined;\n  }\n\n  get endTime() {\n    return this.end ? getSeconds(this.end) : undefined;\n  }\n\n  get downloadText() {\n    const { textContent } = this;\n    const voiceContent = this.voice || '';\n    const text = (textContent || '').trim();\n    const voice = (voiceContent || '').trim();\n    const time = this.end ? [this.start, this.end].join(' - ') : this.start;\n    const heading = voice.length > 0 ? [time, voice].join(': ') : time;\n    return text.length > 0 ? [heading, text].join('\\n') : heading;\n  }\n\n  render() {\n    const { start, voice } = this;\n    return html`${!this.#hasVoice ? nothing : this.#headings.wrap(this.#linkTemplate(html`\n      <span id=\"start\">${start}</span> - <span id=\"voice\">${voice}</span>`, true))}${this.#linkTemplate(html`\n      <slot></slot>\n    `)}`;\n  }\n\n  #linkTemplate(content: unknown = nothing, heading = false) {\n    const id = [\n      this.id,\n      this.startTime && `t${this.startTime}-`,\n      this.endTime,\n      heading ? 'heading' : 'text',\n    ].filter(Boolean).join('');\n    return html`\n      <a id=\"${id}\"\n         href=\"#${id}\"\n         ?active=\"${this.active && !heading}\"\n         @click=${this.#onClick}>${content}</a>`;\n  }\n\n  #onClick() {\n    this.dispatchEvent(new Event('cueseek', { bubbles: true }));\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rh-cue': RhCue;\n  }\n}\n"]}