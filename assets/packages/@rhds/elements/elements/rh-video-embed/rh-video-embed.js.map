{"version":3,"file":"rh-video-embed.js","sourceRoot":"","sources":["rh-video-embed.ts"],"names":[],"mappings":";;AAAA,OAAO,EAAE,UAAU,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,KAAK,CAAC;AACjD,OAAO,EAAE,QAAQ,EAAE,MAAM,4BAA4B,CAAC;AACtD,OAAO,EAAE,aAAa,EAAE,MAAM,kCAAkC,CAAC;AACjE,OAAO,EAAE,KAAK,EAAE,MAAM,yBAAyB,CAAC;AAChD,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AACvD,OAAO,EAAE,cAAc,EAAE,MAAM,qDAAqD,CAAC;AAErF,OAAO,uCAAuC,CAAC;AAC/C,OAAO,yCAAyC,CAAC;AAEjD,OAAO,EAAE,QAAQ,EAAE,MAAM,gCAAgC,CAAC;;;AAI1D,MAAM,OAAO,iBAAkB,SAAQ,KAAK;IAE1C;QACE,KAAK,CAAC,eAAe,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;IAC9D,CAAC;CACF;AAED,MAAM,OAAO,eAAgB,SAAQ,KAAK;IAExC;QACE,KAAK,CAAC,cAAc,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;IAC7D,CAAC;CACF;AAED,MAAM,OAAO,cAAe,SAAQ,KAAK;IAEvC;QACE,KAAK,CAAC,MAAM,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;IACrD,CAAC;CACF;AAED;;;;;;;;;;;;;;;;;;;;;;GAsBG;AAGI,IAAM,YAAY,GAAlB,MAAM,YAAa,SAAQ,UAAU;IAArC;;;QAQL;;WAEG;QACwD,mBAAc,GAAG,KAAK,CAAC;QAElF;;;WAGG;QAC0B,cAAS,GAAG,KAAK,CAAC;QAE/C,2DAA2D;QAC1C,oBAAe,GAAG,KAAK,CAAC;QACxB,iBAAY,GAAG,KAAK,CAAC;QACrB,iBAAY,GAAG,KAAK,CAAC;QAEtC,8BAAS,IAAI,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE,WAAW,EAAE,IAAI,CAAC,EAAC;QAChE,uCAAuC;IA+KzC,CAAC;IAzKC,IAAI,aAAa;QACf,OAAO,IAAI,CAAC,UAAU,EAAE,aAAa,CAAc,iBAAiB,CAAC,CAAC;IACxE,CAAC;IAED,IAAI,cAAc;QAChB,OAAO,IAAI,CAAC,eAAe,CAAC;IAC9B,CAAC;IAED,IAAI,gBAAgB;QAClB,IAAI,EAA2B,CAAC;QAChC,IAAI,uBAAA,IAAI,8DAAa,EAAG,CAAC;YACvB,EAAE,GAAG,IAAI,CAAC,aAA4B,CAAC;QACzC,CAAC;aAAM,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;YAC5B,EAAE,GAAG,IAAI,CAAC,aAA4B,CAAC;QACzC,CAAC;aAAM,CAAC;YACN,EAAE,GAAG,IAAI,CAAC,UAAyB,CAAC;QACtC,CAAC;QACD,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,IAAI,aAAa;QACf,OAAO,uBAAA,IAAI,4BAAQ,CAAC;IACtB,CAAC;IAED,IAAI,UAAU;QACZ,OAAO,IAAI,CAAC,UAAU,EAAE,aAAa,CAAc,OAAO,CAAC,CAAC;IAC9D,CAAC;IAED,IAAI,WAAW;QACb,OAAO,IAAI,CAAC,YAAY,CAAC;IAC3B,CAAC;IAED,IAAI,WAAW;QACb,OAAO,IAAI,CAAC,YAAY,CAAC;IAC3B,CAAC;IAED,YAAY;QACV,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,uBAAA,IAAI,wBAAW,uBAAA,IAAI,wDAAW,MAAf,IAAI,CAAa,MAAA,CAAC;QACnC,CAAC;IACH,CAAC;IAED,MAAM;QACJ,MAAM,EAAE,WAAW,EAAE,GAAG,IAAI,CAAC;QAC7B,MAAM,UAAU,GAAG,uBAAA,IAAI,2BAAO,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QACrD,MAAM,YAAY,GAAG,uBAAA,IAAI,2BAAO,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QACzD,MAAM,SAAS,GAAG,uBAAA,IAAI,4BAAQ,IAAI,uBAAA,IAAI,4BAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,uBAAA,IAAI,4BAAQ,CAAC,KAAK,eAAe,CAAC,CAAC,CAAC,YAAY,CAAC;QAC3G,MAAM,OAAO,GAAG,uBAAA,IAAI,8DAAa,CAAC;QAClC,MAAM,KAAK,GAAG,CAAC,CAAC,WAAW,IAAI,CAAC,YAAY,CAAC;QAC7C,MAAM,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC;QAEjE,OAAO,IAAI,CAAA;qCACsB,QAAQ,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC;;8BAEnC,IAAI,KAAK,WAAW;;;;;YAKtC,uBAAA,IAAI,8DAAa,CAAC,CAAC,CAAC,IAAI,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;4BA0BR,uBAAA,IAAI,iEAAoB;4BACxB,uBAAA,IAAI,iEAAoB;;;WAGzC,CAAC,CAAC,CAAC,EAAE;;;;gCAIgB,IAAI,KAAK,WAAW;+BACrB,uBAAA,IAAI,8DAAiB;+BACrB,uBAAA,IAAI,8DAAiB;0EACsB,SAAS;;;8CAGrC,CAAC,UAAU;;KAEpD,CAAC;IACJ,CAAC;;;;;;IAzGC,OAAO,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;AAChD,CAAC;;IA2GC,MAAM,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;IAChD,MAAM,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,QAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;IAChF,MAAM,MAAM,GAAG,IAAI,CAAC,CAAC;QACnB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,EAAE,SAAS,CAAC,IAAI,CAAsB,CAAC,CAAC,CAAC,SAAS,CAAC;IACjF,OAAO,MAAM,CAAC;AAChB,CAAC;;IAGC,IAAI,uBAAA,IAAI,4BAAQ,EAAE,CAAC;QACjB,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,uBAAA,IAAI,4BAAQ,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC;QAC5D,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;QACzC,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QACpC,uBAAA,IAAI,4BAAQ,CAAC,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC;QAC5B,uBAAA,IAAI,4BAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC3C,uBAAA,IAAI,4BAAQ,CAAC,KAAK,GAAG,UAAU,CAAC;QAChC,uBAAA,IAAI,4BAAQ,CAAC,IAAI,GAAG,UAAU,CAAC;IACjC,CAAC;IACD,uBAAA,IAAI,wDAAW,MAAf,IAAI,CAAa,CAAC;AACpB,CAAC;;IAGC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;IAC5B,IAAI,CAAC,aAAa,CAAC,IAAI,iBAAiB,EAAE,CAAC,CAAC;AAC9C,CAAC;6EAEmB,KAAoB;IACtC,QAAQ,KAAK,CAAC,GAAG,EAAE,CAAC;QAClB,KAAK,GAAG,CAAC;QACT,KAAK,OAAO;YACV,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAC5B,IAAI,CAAC,aAAa,CAAC,IAAI,iBAAiB,EAAE,CAAC,CAAC;YAC5C,MAAM;IACV,CAAC;AACH,CAAC;;IAGC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;QACtB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,aAAa,CAAC,IAAI,eAAe,EAAE,CAAC,CAAC;QAC1C,uBAAA,IAAI,yDAAY,MAAhB,IAAI,CAAc,CAAC;IACrB,CAAC;AACH,CAAC;uEAEgB,KAAoB;IACnC,QAAQ,KAAK,CAAC,GAAG,EAAE,CAAC;QAClB,KAAK,GAAG,CAAC;QACT,KAAK,OAAO;YACV,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;gBACtB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBACzB,IAAI,CAAC,aAAa,CAAC,IAAI,eAAe,EAAE,CAAC,CAAC;gBAC1C,uBAAA,IAAI,yDAAY,MAAhB,IAAI,CAAc,CAAC;YACrB,CAAC;YACD,MAAM;IACV,CAAC;AACH,CAAC;;IAGC,IAAI,CAAC,uBAAA,IAAI,8DAAa,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;QACjE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACrC,IAAI,CAAC,aAAa,EAAE,KAAK,EAAE,CAAC;QAC5B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,aAAa,CAAC,IAAI,cAAc,EAAE,CAAC,CAAC;IAC3C,CAAC;AACH,CAAC;AAtMe,mBAAM,GAAG,CAAC,MAAM,CAAC,AAAX,CAAY;AAElB,8BAAiB,GAAmB;IAClD,GAAG,UAAU,CAAC,iBAAiB;IAC/B,cAAc,EAAE,IAAI;CACrB,AAHgC,CAG/B;AAKyD;IAA1D,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,SAAS,EAAE,iBAAiB,EAAE,CAAC;oDAAwB;AAMrD;IAA5B,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;+CAAmB;AAG9B;IAAhB,KAAK,EAAE;qDAAiC;AACxB;IAAhB,KAAK,EAAE;kDAA8B;AACrB;IAAhB,KAAK,EAAE;kDAA8B;AAtB3B,YAAY;IAFxB,aAAa,CAAC,gBAAgB,CAAC;IAC/B,QAAQ;GACI,YAAY,CAwMxB","sourcesContent":["import { LitElement, html, isServer } from 'lit';\nimport { property } from 'lit/decorators/property.js';\nimport { customElement } from 'lit/decorators/custom-element.js';\nimport { state } from 'lit/decorators/state.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { SlotController } from '@patternfly/pfe-core/controllers/slot-controller.js';\n\nimport '@rhds/elements/rh-button/rh-button.js';\nimport '@rhds/elements/rh-surface/rh-surface.js';\n\nimport { themable } from '@rhds/elements/lib/themable.js';\n\nimport styles from './rh-video-embed.css';\n\nexport class ConsentClickEvent extends Event {\n  declare target: RhVideoEmbed;\n  constructor() {\n    super('consent-click', { bubbles: true, cancelable: true });\n  }\n}\n\nexport class VideoClickEvent extends Event {\n  declare target: RhVideoEmbed;\n  constructor() {\n    super('request-play', { bubbles: true, cancelable: true });\n  }\n}\n\nexport class VideoPlayEvent extends Event {\n  declare target: RhVideoEmbed;\n  constructor() {\n    super('play', { bubbles: true, cancelable: true });\n  }\n}\n\n/**\n * A Video embed is a graphical preview of a video overlayed with a play button. When clicked, the embedded YouTube video will begin playing.\n *\n * @summary Reveals a small area of information on hover\n *\n * @alias video-embed\n *\n * @fires consent-click - \"Update preferences\" consent button is clicked\n * @fires request-play - Play button is clicked\n * @fires play - Video is about to be played\n * @slot - Place video embed code here; iframe should include a `title` attribute with the video title\n * @slot play-button-text - Text for play button; recommended value \"Video title (video)\"\n * @slot thumbnail - Optional thumbnail image on top of video embed; should include `alt` text\n * @slot consent-message - Text explaining opt-in to cookies is required, e.g. `<p>View this video by opting in to “Advertising Cookies.”</p>`\n * @slot consent-button-text - Text for CTA button to update preferences, e.g. \"Update preferences\"\n * @slot caption - Optional caption below video embed\n * @slot autoplay - DO NOT USE! (Used by `rh-video-embed`.)\n * @csspart figure - The outer container for rh-video-embed\n * @csspart video - The container for the video, thumbnail, and play button\n * @csspart consent-body - The container for the consent message and consent button\n * @csspart play - The play button on top of the thumbnail\n * @csspart caption - The container for the caption\n */\n@customElement('rh-video-embed')\n@themable\nexport class RhVideoEmbed extends LitElement {\n  static readonly styles = [styles];\n\n  static readonly shadowRootOptions: ShadowRootInit = {\n    ...LitElement.shadowRootOptions,\n    delegatesFocus: true,\n  };\n\n  /**\n   * Add to `rh-video-embed` when a video requires consent for cookies\n   */\n  @property({ type: Boolean, attribute: 'require-consent' }) requireConsent = false;\n\n  /**\n   * Boolean flag to flip with JavaScript when cookie consent has been granted or revoked.\n   * See the Require Consent demo for reference.\n   */\n  @property({ type: Boolean }) consented = false;\n\n  // TODO(bennyp): https://lit.dev/docs/data/context/#content\n  @state() private _consentClicked = false;\n  @state() private _playClicked = false;\n  @state() private _playStarted = false;\n\n  #slots = new SlotController(this, 'caption', 'thumbnail', null);\n  #iframe: HTMLIFrameElement | undefined;\n\n  get #showConsent() {\n    return this.requireConsent && !this.consented;\n  }\n\n  get consentButton() {\n    return this.shadowRoot?.querySelector<HTMLElement>('#consent-button');\n  }\n\n  get consentClicked() {\n    return this._consentClicked;\n  }\n\n  get focusableElement() {\n    let el: HTMLElement | undefined;\n    if (this.#showConsent ) {\n      el = this.consentButton as HTMLElement;\n    } else if (this.playClicked) {\n      el = this.iframeElement as HTMLElement;\n    } else {\n      el = this.playButton as HTMLElement;\n    }\n    return el;\n  }\n\n  get iframeElement() {\n    return this.#iframe;\n  }\n\n  get playButton() {\n    return this.shadowRoot?.querySelector<HTMLElement>('#play');\n  }\n\n  get playClicked() {\n    return this._playClicked;\n  }\n\n  get playStarted() {\n    return this._playStarted;\n  }\n\n  firstUpdated() {\n    if (!isServer) {\n      this.#iframe = this.#getIframe();\n    }\n  }\n\n  render() {\n    const { playClicked } = this;\n    const hasCaption = this.#slots.hasSlotted('caption');\n    const hasThumbnail = this.#slots.hasSlotted('thumbnail');\n    const playLabel = this.#iframe && this.#iframe.title ? `${this.#iframe.title} (play video)` : 'Play video';\n    const consent = this.#showConsent;\n    const video = !!playClicked || !hasThumbnail;\n    const show = consent ? 'consent' : video ? 'video' : 'thumbnail';\n\n    return html`\n      <figure part=\"figure\" class=\"${classMap({ video, consent })}\">\n        <div part=\"video\" id=\"video\">\n          <div aria-hidden=\"${show !== 'thumbnail'}\">\n            <slot id=\"thumbnail\" name=\"thumbnail\"></slot>\n          </div>\n          <slot></slot>\n          <div id=\"autoplay\"><slot name=\"autoplay\"></slot></div>\n          ${this.#showConsent ? html`\n            <rh-surface id=\"consent\" color-palette=\"darker\">\n              <svg id=\"watermark\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 1136 639\">\n                <defs>\n                  <clipPath id=\"clip-path\">\n                    <rect id=\"Rectangle\" width=\"1136\" height=\"639\" transform=\"translate(150 212)\" fill=\"#212427\"/>\n                  </clipPath>\n                  <clipPath id=\"clip-path-2\">\n                    <rect id=\"Rectangle_1\" data-name=\"Rectangle 1\" width=\"1000.925\" height=\"756.901\" fill=\"none\"/>\n                  </clipPath>\n                </defs>\n                <g id=\"Mask_Group_1\" data-name=\"Mask Group 1\" transform=\"translate(-150 -212)\" clip-path=\"url(#clip-path)\">\n                  <g id=\"Group_2000\" data-name=\"Group 2000\" transform=\"translate(50.847 23.483)\" opacity=\"0.2\">\n                    <g id=\"Group_1999\" data-name=\"Group 1999\" clip-path=\"url(#clip-path-2)\">\n                      <path id=\"Path_3\" data-name=\"Path 3\" d=\"M667.591,436.2c65.743-.063,160.93-13.755,160.857-91.955-.005-6.1-.173-12.042-1.645-17.992L787.482,156.147c-9.114-37.392-17.046-54.39-82.815-87.2C653.636,42.937,542.528-.032,509.656,0c-30.6.026-39.626,39.7-75.9,39.731-35.126.032-61.218-29.408-94.094-29.376-31.72.032-52.114,21.576-67.935,65.8,0,0-44.093,124.706-49.749,142.834a33.047,33.047,0,0,0-1.156,10.213c.047,48.45,191.011,207.231,446.766,207m171.085-60.229c9.114,43.058,9.114,47.589,9.119,53.255.074,73.68-82.641,114.546-191.432,114.645-245.953.226-461.415-143.507-461.5-238.71a97,97,0,0,1,7.889-38.543C114.352,271.234-.1,287.2,0,388.072.148,553.538,392.488,757.185,703.022,756.9c238.021-.216,297.977-107.934,297.9-192.935-.068-66.884-57.932-142.75-162.245-187.994\" transform=\"translate(0.004 0)\"/>\n                    </g>\n                  </g>\n                </g>\n              </svg>\n              <div part=\"consent-body\" id=\"consent-body\">\n                <slot name=\"consent-message\">\n                  <p id=\"consent-message\">View this video by opting in to “Advertising Cookies.”</p>\n                </slot>\n                <rh-button\n                  id=\"consent-button\"\n                  variant=\"tertiary\"\n                  @click=\"${this.#handleConsentClick}\"\n                  @keyup=\"${this.#handleConsentKeyup}\"><slot name=\"consent-button-text\">Update preferences</slot></rh-button>\n              </div>\n            </rh-surface>\n          ` : ''}\n          <rh-button part=\"play\"\n                     id=\"play\"\n                     variant=\"play\"\n                     ?hidden=\"${show !== 'thumbnail'}\"\n                     @click=\"${this.#handlePlayClick}\"\n                     @keyup=\"${this.#handlePlayKeyup}\">\n            <span class=\"visually-hidden\"><slot name=\"play-button-text\">${playLabel}</slot></span>\n          </rh-button>\n        </div>\n        <figcaption part=\"caption\" ?hidden=\"${!hasCaption}\"><slot name=\"caption\"></slot></figcaption>\n      </figure>\n    `;\n  }\n\n  #getIframe() {\n    const template = this.querySelector('template');\n    const node = template ? document.importNode(template.content, true) : undefined;\n    const iframe = node ?\n      node.querySelector('iframe')?.cloneNode(true) as HTMLIFrameElement : undefined;\n    return iframe;\n  }\n\n  #copyIframe() {\n    if (this.#iframe) {\n      const url = new URL(this.#iframe.getAttribute('src') || '');\n      url.searchParams.append('autoplay', '1');\n      url.searchParams.append('rel', '0');\n      this.#iframe.src = url.href;\n      this.#iframe.classList.add('rh-yt-iframe');\n      this.#iframe.allow = 'autoplay';\n      this.#iframe.slot = 'autoplay';\n    }\n    this.#playVideo();\n  }\n\n  #handleConsentClick() {\n    this._consentClicked = true;\n    this.dispatchEvent(new ConsentClickEvent());\n  }\n\n  #handleConsentKeyup(event: KeyboardEvent) {\n    switch (event.key) {\n      case ' ':\n      case 'Enter':\n        this._consentClicked = true;\n        this.dispatchEvent(new ConsentClickEvent());\n        break;\n    }\n  }\n\n  #handlePlayClick() {\n    if (!this.playClicked) {\n      this._playClicked = true;\n      this.dispatchEvent(new VideoClickEvent());\n      this.#copyIframe();\n    }\n  }\n\n  #handlePlayKeyup(event: KeyboardEvent) {\n    switch (event.key) {\n      case ' ':\n      case 'Enter':\n        if (!this.playClicked) {\n          this._playClicked = true;\n          this.dispatchEvent(new VideoClickEvent());\n          this.#copyIframe();\n        }\n        break;\n    }\n  }\n\n  #playVideo() {\n    if (!this.#showConsent && this.playClicked && this.iframeElement) {\n      this.appendChild(this.iframeElement);\n      this.iframeElement?.focus();\n      this._playStarted = true;\n      this.dispatchEvent(new VideoPlayEvent());\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'rh-video-embed': RhVideoEmbed;\n  }\n}\n"]}