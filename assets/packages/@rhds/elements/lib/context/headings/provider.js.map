{"version":3,"file":"provider.js","sourceRoot":"","sources":["provider.ts"],"names":[],"mappings":"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","sourcesContent":["import type { LitElement } from 'lit';\n\nimport { ContextProvider } from '@lit/context';\n\nconst SELECTORS = `H1,H2,H3,H4,H5,H6`;\n\nimport { createContextWithRoot } from '@patternfly/pfe-core/functions/context.js';\n\nexport interface HeadingContext {\n  /** Root Heading level. default 1 */\n  level: number;\n  /** Heading offset for children. default 1 */\n  offset: number;\n}\n\nexport const context = createContextWithRoot<HeadingContext>('rh-heading-context');\n\nexport interface HeadingLevelContextOptions extends HeadingContext {\n  /**\n   * Attribute to read on the host which will determine root heading level.\n   */\n  attribute?: string;\n}\n\n/**\n * **START**\n * `H`\n * named capture group 1 `lvl`:\n * > **0-9**\n * **END**\n */\nconst HLVL_RE = /^H(?<lvl>\\d)$/;\n\nfunction getLevel(heading?: Element | null): number {\n  const { lvl } = heading?.tagName.match(HLVL_RE)?.groups ?? {};\n  return parseInt(lvl ?? '');\n}\n\nfunction canQuery(node: Node): node is Document | ShadowRoot {\n  return typeof (node as Element).querySelectorAll === 'function';\n}\n\n/**\n * Determines which heading level immediately precedes the host element,\n * and provides templates for shadow headings.\n */\nexport class HeadingLevelContextProvider extends ContextProvider<typeof context, LitElement> {\n  /** Heading level preceding component document, as in 1 for <h1>, 2 for <h2> etc. */\n  #options?: HeadingLevelContextOptions;\n\n  constructor(\n    public host: LitElement,\n    options?: Partial<HeadingLevelContextOptions>,\n  ) {\n    super(host, { context });\n    this.#options = { level: 1, offset: 1, ...options };\n    this.#options.level ??= 1;\n    this.#options.offset ??= 1;\n    this.setValue({});\n  }\n\n  setValue(ctx: Partial<HeadingContext>) {\n    const offset = this.#options?.offset ?? 1;\n    const level = this.#options?.level ?? 1;\n    super.setValue({ offset, level, ...ctx });\n  }\n\n  hostConnected() {\n    super.hostConnected();\n    const level = this.#getLevel();\n    this.setValue({ level });\n  }\n\n  #getLevel() {\n    const level = this.host.getAttribute(this.#options?.attribute ?? '')\n      ?? this.#computeLevelFromChildren()\n      ?? 1;\n    const val = typeof level === 'string' ? parseInt(level) : level;\n    if (typeof val === 'number' && !Number.isNaN(val)) {\n      return val;\n    }\n  }\n\n  #computeLevelFromChildren() {\n    const { host } = this;\n    const slotted = host.querySelector(SELECTORS);\n    if (slotted && host.shadowRoot) {\n      return getLevel(slotted);\n    } else {\n      const root = host.getRootNode();\n      if (canQuery(root)) {\n        const { localName } = host;\n        const els = [...root.querySelectorAll(`${SELECTORS},${localName}`)];\n        const lastHeadingBeforeHost = els.slice(0, els.indexOf(host)).pop();\n        return getLevel(lastHeadingBeforeHost);\n      }\n    }\n  }\n}\n"]}