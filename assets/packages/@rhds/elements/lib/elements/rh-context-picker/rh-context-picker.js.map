{"version":3,"file":"rh-context-picker.js","sourceRoot":"","sources":["rh-context-picker.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, LitElement } from 'lit';\nimport { customElement } from 'lit/decorators/custom-element.js';\nimport { property } from 'lit/decorators/property.js';\nimport { query } from 'lit/decorators/query.js';\n\nimport { type ColorPalette } from '../../context/color/provider.js';\nimport { colorContextConsumer, type ColorTheme } from '../../context/color/consumer.js';\n\nimport type { Color } from '@rhds/tokens/js/types.js';\nimport {\n  ColorSurfaceDarkest as darkest,\n  ColorSurfaceDarker as darker,\n  ColorSurfaceDark as dark,\n  ColorSurfaceLight as light,\n  ColorSurfaceLighter as lighter,\n  ColorSurfaceLightest as lightest,\n} from '@rhds/tokens/color.js';\n\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport '@rhds/elements/rh-tooltip/rh-tooltip.js';\n\nimport style from './rh-context-picker.css';\n\nexport class ContextChangeEvent extends Event {\n  constructor(public colorPalette: ColorPalette) {\n    super('change', { bubbles: true, cancelable: true });\n  }\n}\n\n@customElement('rh-context-picker')\nexport class RhContextPicker extends LitElement {\n  static formAssociated = true;\n\n  static readonly styles = [style];\n\n  static readonly palettes = new Map<ColorPalette, Color>(Object.entries({\n    darkest,\n    darker,\n    dark,\n    light,\n    lighter,\n    lightest,\n  }) as [ColorPalette, Color][]);\n\n  private static offsets: Partial<Record<ColorPalette, number>> = {\n    darkest: -4,\n    darker: -3,\n    dark: -3,\n    light: -1,\n    lighter: 1,\n    lightest: 2,\n  };\n\n  private static paletteNames = Array.from(RhContextPicker.palettes, ([name]) => name);\n\n  declare shadowRoot: ShadowRoot;\n\n  /** ID of context element to toggle (same root) */\n  @property() target?: string;\n\n  @property() value: ColorPalette = 'darkest';\n\n  @query('#context-range') private range?: HTMLInputElement;\n\n  @colorContextConsumer() private on?: ColorTheme;\n\n  @property({\n    converter: {\n      fromAttribute(list: string) {\n        return list?.split(',')\n            ?.map(x => x.trim())\n            ?.filter(x => RhContextPicker.paletteNames.includes(x as ColorPalette)) ?? [];\n      },\n      toAttribute(list: ColorPalette[]) {\n        return list.join(',');\n      },\n    },\n  }) allow = RhContextPicker.paletteNames;\n\n  #offset = RhContextPicker.offsets[this.value];\n\n  #internals = this.attachInternals();\n\n  #target: HTMLElement | null = null;\n\n  willUpdate() {\n    this.#offset = RhContextPicker.offsets[this.value];\n  }\n\n  render() {\n    const { on = 'dark', value = 'darkest' } = this;\n    const derivedLabel = this.#internals.ariaLabel\n      ?? Array.from(this.#internals.labels, x => x.textContent).join();\n    return html`\n      <div id=\"container\" class=\"${classMap({ [on]: true })}\">\n          <input id=\"context-range\"\n                 class=\"${classMap({ [value]: true })}\"\n                 name=\"range\"\n                 type=\"range\"\n                 list=\"palettes\"\n                 min=\"0\"\n                 max=\"${this.allow.length - 1}\"\n                .value=\"${this.allow.indexOf(this.value).toString()}\"\n                 aria-label=\"${derivedLabel}\"\n                 style=\"${styleMap({\n                   '--count': `${this.allow.length}`,\n                   '--offset': `${this.#offset}px`,\n                  })}\"\n                 @input=\"${this.#onInput}\">\n          <datalist id=\"palettes\">${this.allow.map(palette => html`\n            <option id=\"option-${palette}\"\n                    value=\"${palette}\"\n                    title=\"${palette}\"\n                    @click=\"${() => this.#setValue(palette)}\">\n              <span class=\"visually-hidden\">${palette}</span>\n            </option>`)}\n          </datalist>\n      </div>\n    `;\n  }\n\n  formStateRestoreCallback(state: string) {\n    this.#setValue(state as this['value']);\n  }\n\n  firstUpdated() {\n    const oldTarget = this.#target;\n    if (this.target) {\n      const root = this.getRootNode() as Document | ShadowRoot;\n      this.#target = root.getElementById(this.target);\n      this.sync();\n    } else {\n      this.#target = this.closest('rh-surface');\n    }\n    oldTarget?.removeEventListener('change', this.#onChange);\n    this.#target?.addEventListener('change', this.#onChange);\n  }\n\n  #onChange(event: Event) {\n    if (event instanceof ContextChangeEvent) {\n      event.stopPropagation();\n    }\n  }\n\n  #onInput(event: Event) {\n    if (event.target instanceof HTMLInputElement) {\n      event.stopPropagation();\n      const value = this.allow.at(+event.target.value);\n      if (value) {\n        this.#setValue(value);\n      }\n    }\n  }\n\n  #setValue(value: this['value']) {\n    this.#internals.setFormValue(value);\n    if (value !== this.value && this.dispatchEvent(new ContextChangeEvent(value))) {\n      this.value = value;\n      this.sync();\n    }\n  }\n\n  sync() {\n    if (this.value) {\n      this.#target?.setAttribute('color-palette', this.value);\n    }\n  }\n}\n"]}