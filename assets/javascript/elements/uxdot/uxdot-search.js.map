{"version":3,"file":"uxdot-search.js","sourceRoot":"","sources":["../../../../../uxdot/uxdot-search.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html, isServer } from 'lit';\nimport { ifDefined } from 'lit/directives/if-defined.js';\n\nimport { customElement } from 'lit/decorators/custom-element.js';\nimport { property } from 'lit/decorators/property.js';\n\nimport '@rhds/elements/rh-button/rh-button.js';\n\nimport styles from './uxdot-search.css';\n\ninterface Item {\n  label: string;\n  value: string;\n}\n\n@customElement('uxdot-search')\nexport class UxdotSearch extends LitElement {\n  static formAssociated = true;\n\n  static styles = [styles];\n\n  @property() placeholder?: string;\n\n  @property({ type: Array, attribute: false }) items: Item[] = [];\n\n  @property({ type: Boolean, state: true }) expanded = false;\n\n  @property({ type: Number, state: true }) activeIndex?: number;\n\n  private static instances = new Set<UxdotSearch>();\n\n  static {\n    globalThis?.addEventListener?.('click', event => {\n      for (const instance of UxdotSearch.instances) {\n        instance.#onOutsideClick(event);\n      }\n    });\n  }\n\n  #internals = !isServer ? this.attachInternals() : null;\n\n  #ariaLabel = '';\n\n  get form() {\n    return this.#internals?.form ?? null;\n  }\n\n  @property()\n  get value() {\n    return this.#input?.value ?? '';\n  }\n\n  set value(value) {\n    if (this.#input) {\n      this.#input.value = value ?? '';\n    }\n  }\n\n  get #input() {\n    return this.shadowRoot?.getElementById('input') as HTMLInputElement | null ?? null;\n  }\n\n  get #firstLink(): HTMLAnchorElement | null {\n    return this.shadowRoot?.querySelector('li a') ?? null;\n  }\n\n  get #lastLink(): HTMLAnchorElement | null {\n    return this.shadowRoot?.querySelector('li:last-of-type a') ?? null;\n  }\n\n  get selectedItem() {\n    return this.shadowRoot?.querySelector('[aria-selected=\"true\"]');\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener('keydown', this.#onKeydown);\n    this.addEventListener('blur', this.#onBlur);\n    this.#ariaLabel = this.getAttribute('aria-label') ?? '';\n    this.removeAttribute('aria-label');\n    if (this.#ariaLabel) {\n      this.setAttribute('original-aria-label', this.#ariaLabel);\n    }\n    this.requestUpdate();\n  }\n\n  render() {\n    return html`\n      <input id=\"input\"\n             placeholder=\"${ifDefined(this.placeholder)}\"\n             role=\"combobox\"\n             aria-label=\"${ifDefined(this.#ariaLabel)}\"\n             aria-autocomplete=\"list\"\n             aria-controls=\"listbox\"\n             aria-expanded=\"${String(this.expanded)}\"\n             @input=\"${this.#onInput}\">\n      <div id=\"container\" tabindex=\"-1\" ?hidden=\"${!this.expanded}\">\n        <ol id=\"listbox\"\n            role=\"listbox\"\n            aria-labelledby=\"input\">${this.items.map((item, i) => !item ? '' : html`\n          <li role=\"option\"\n              data-i=\"${i}\"\n              aria-selected=\"${this.activeIndex === i}\">\n            <a id=\"i-${i}\"\n               tabindex=\"${this.activeIndex === i ? 0 : -1}\"\n               href=\"${item.value}\"\n               @blur=\"${this.#onBlur}\">${item.label}</a>\n          </li>`)}\n        </ol>\n      </div>\n      <rh-button id=\"button\"\n                 aria-controls=\"listbox\"\n                 aria-expanded=\"${String(this.expanded)}\"\n                 @click=\"${this.#onClickSearch}\">Search</rh-button>\n    `;\n  }\n\n  #onOutsideClick(event: Event) {\n    if (event.composedPath().every(x => x !== this)) {\n      this.expanded = false;\n    }\n  }\n\n  #onClickSearch() {\n    this.expanded = true;\n    if (this.value && !isServer) {\n      this.form?.requestSubmit();\n    }\n  }\n\n  async #onBlur() {\n    await this.updateComplete;\n    if (!this.shadowRoot?.activeElement) {\n      await this.updateComplete;\n      this.expanded = false;\n      if (this.selectedItem) {\n        this.value = this.selectedItem.textContent?.trim() ?? '';\n      }\n    }\n  }\n\n  #onInput() {\n    this.#internals?.setFormValue(this.value);\n    if (this.value) {\n      this.expanded = true;\n    }\n  }\n\n  #onKeydown(event: KeyboardEvent) {\n    switch (event.key) {\n      case 'ArrowDown':\n      case 'ArrowUp': {\n        this.expanded = true;\n        return this.#focus(event);\n      }\n      case 'Escape': this.expanded = false; break;\n      case 'Enter': this.form?.requestSubmit();\n    }\n  }\n\n  #focus(event: KeyboardEvent) {\n    event.preventDefault();\n    this.activeIndex ??= -1;\n    const d = ({ ArrowDown: 1, ArrowUp: -1 })[event.key]!;\n    const activeElement = this.shadowRoot?.activeElement;\n    if (activeElement === this.#input) {\n      ({ ArrowUp: this.#lastLink, ArrowDown: this.#firstLink })[event.key]?.focus();\n      this.activeIndex = d > 0 ? 0 : this.items.length - 1;\n    } else if (activeElement instanceof HTMLAnchorElement) {\n      const nextIndex = this.activeIndex + d;\n      const nextItem = this.items[nextIndex];\n      const nextFocus = this.shadowRoot?.getElementById(`i-${nextIndex}`) ?? this.#input;\n      this.activeIndex = nextItem ? nextIndex : -1;\n      nextFocus?.focus();\n    }\n  }\n}\n\n"]}